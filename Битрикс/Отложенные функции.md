Это технология, благодаря которой некоторую информацию или контент можно вывести раньше, чем то место в коде, где она фактически задается.

Принцип их работы простыми словами:

1. В том месте, где требуется вывести контент, вызывается отложенная функция (обычно они начинаются со слова “Show”).
2. В буфере с формируемым HTML страницы в месте вызова отложенной функции добавляется метка.
3. Выполнение скрипта доходит до того места, где устанавливается нужное значение для этой метки с помощью соответствующего метода (обычно такие методы начинаются с “Set”).
4. В служебной части эпилога метка из пункта 1 заменяется на значение, установленное в пункте 3.
5. HTML в итоговом виде выводится на экран.

На примере вывода свойств страницы/раздела:

- **CMain::ShowProperty** - этим методом в коде задается место (метка), куда нужно будет вывести значение свойства страницы.
- **CMain::SetPageProperty** - этим методом где-то в скрипте далее будет задано значение свойства.
- **CMain::GetProperty** - та функция, выполнение которой “откладывается”. Именно эта функция вызывается в эпилоге, когда формируется итоговый HTML и она возвращает последнее значение, установленное методом **CMain::SetPageProperty**.

> [!NOTE] 
> #### Важно понимать разницу между “echo Get…” и “Show…”
В первом случае на странице будет выведено текущее значение, а во втором – пометка, что после завершения работы страницы, сюда нужно поместить последнее значение.
В реальной разработке “echo Get…” почти никогда не используется.

Стандартные функции, обеспечивающие отложенный вывод внутри себя, так или иначе используют метод **CMain::AddBufferContent**. Этим же методом можно создавать и свои собственные отложенные функции, по аналогии со стандартными.

Если компонент предусматривает кеширование, то установка значения для отложенных функций с помощью того же **CMain::SetPageProperty** или ему подобных, не будет работать в кешируемой области компонента (то есть в **result_modifier.php** и **template.php**). Это объясняется тем, что при наличии валидного кеша, эти файлы попросту не исполняются и Set-метод не будет вызван.

Для применения технологии отложенных функций в кешируемой области компонента предусмотрены специальные методы:

- Для установки значения: **CBitrixComponentTemplate::SetViewTarget / EndViewTarget.**
- Для обозначения места, где контент должен быть выведен: **CMain::ShowViewContent**.

---

Так как данные в result_modifier.php кешируются, то нельзя там подключать установку данных для отложенной функции. Там нужно указать какие дополнительные ключи стоит кешировать
```php
$this->__component->SetResultCacheKeys(["DISPLAY_DATE"]);
```
DISPLAY_DATE - ключ $arResult, который формируется динамически и поэтому не попадает в кеш. Далее нам нужно в componen_epilog.php прочитать эти данные и добавить в отложенную функцию
```php
global $APPLICATION;  
$APPLICATION->SetPageProperty('news_date_start', $arResult["DISPLAY_DATE"]);
```
Далее читаем
```php
$APPLICATION->ShowProperty('news_date_start')
```

- `SetResultCacheKeys()` нужен, если **значение должно быть доступно в $arResult ещё до подключения шаблона**, например в `component_epilog.php` или в других обработчиках.
- Всё, что используется **только внутри шаблона**, можно просто положить в `$arResult` без этого метода.

---
### Буфферизация

SetViewTarget Не отобразит то что находится внутри, а сохранит для дальнейшего отображения
```php
<?php if ($arResult['RELATED_PRODUCT']): ?>  
    <?php $this->SetViewTarget('news_related_product'); ?>  
    <a class="news-related-product-block" href="<?= $arResult['RELATED_PRODUCT']['DETAIL_PAGE_URL'] ?>">  
        <img class="img img_lazy lazyload object-fit-cover"  
             src="<?= $arResult['RELATED_PRODUCT']['IMG']['src'] ?>"  
             alt="<?= $arResult['RELATED_PRODUCT']['NAME'] ?>"  
             title="<?= $arResult['RELATED_PRODUCT']['NAME'] ?>"  
             width="<?= $arResult['RELATED_PRODUCT']['IMG']['width'] ?>"  
             height="<?= $arResult['RELATED_PRODUCT']['IMG']['height'] ?>">  
        <div><?= $arResult['RELATED_PRODUCT']['NAME'] ?></div>  
    </a>    
    <?php $this->EndViewTarget(); ?>  
<?php endif; ?>
```

```php
<?= $APPLICATION->ShowViewContent('news_related_product') ?>
```

https://academy.1c-bitrix.ru/courses/?COURSE_ID=310&LESSON_ID=31572&LESSON_PATH=27528.31572