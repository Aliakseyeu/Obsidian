Почта и смс

Настройки - Настройки продукта - Почтовые и СМС события

---
### Почта

В коде фреймворка в модулях и компонентах отправка писем в основном инициируется методом **\Bitrix\Main\Mail\Event::send**. Для его вызова нужно указать тип почтового события.

В системе есть предустановленные макросы:

- **#DEFAULT_EMAIL_FROM#** - E-Mail адрес по умолчанию (устанавливается в настройках).
- **#SITE_NAME#** - Название сайта (устанавливается в настройках).
- **#SERVER_NAME#** - URL сервера (устанавливается в настройках).

Через обработчик почтового события **OnBeforeEventAdd** список полей для макросов может быть расширен.
### Очередь отправки

Большинство писем отправляется не сразу, а попадает в таблицу БД b_event, откуда уже на хитах или на кроне (зависит от настроек сайта) отправляется небольшими порциями. Это позволяет уберечь сайт от нагрузки, если возникла необходимость отправить тысячи писем.

У письма в очереди есть статус, по которому можно точно сказать, что происходит с письмом. Это столбец **SUCCESS_EXEC**. Признаком успеха отправки письма будет статус Y, ошибки — F. Более подробное описание статусов вы найдете в документации платформы (смотрите список полезных ссылок в конце)

Письмо может быть отправлено в обход очереди, если использовать метод **Bitrix\Main\Mail\Event::sendImmediate**

### Оформление письма

- Настройки - Настройки продукта - Почтовые и СМС события - Темы оформления
- Указываем название как будет называться наш шаблон
- Тип: Шаблон для почтовых писем
- Вставить верстку
- Переносим из /bitrix/templates в /local/templates
- В нужном шаблоне выбрать тему оформления
